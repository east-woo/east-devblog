{"componentChunkName":"component---src-templates-post-jsx","path":"/CleanCode-12/","result":{"data":{"site":{"siteMetadata":{"title":"east-woo"}},"markdownRemark":{"id":"f0d45dae-fb83-52a6-9bc5-1beb3151e378","excerpt":"Chapter 13. 동시성\npage 225 ~ 244\n부록 407 ~ 466 1. 동시성 프로그래밍이란 어플리케이션을 효율적으로 실행하기 위해 멀티코어를 온전히 활용하도록 구현하는 방식 외부 서비스의 응답을 기다리면서 아무일도 하지 않으면 CPU 사이클이 낭비된다 낭비되는 자원을 줄이자 동시성 프로그래밍 이해하기  동시성이 구현되지 않는 경우  서버가 …","html":"<p><strong>Chapter 13. 동시성</strong><br>\n<strong>page 225 ~ 244</strong><br>\n<strong>부록 407 ~ 466</strong></p>\n<h2>1. 동시성 프로그래밍이란</h2>\n<blockquote>\n<p><strong>어플리케이션을 효율적으로 실행하기 위해 멀티코어를 온전히 활용하도록 구현하는 방식</strong></p>\n</blockquote>\n<ul>\n<li>외부 서비스의 응답을 기다리면서 아무일도 하지 않으면 CPU 사이클이 낭비된다</li>\n<li>낭비되는 자원을 줄이자</li>\n</ul>\n<h3>동시성 프로그래밍 이해하기</h3>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/0c979072203e5bee4f2364d3a940efcf/3d463/img.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 45.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQoz6VSu07EMBDMN/IPfAXfQUtBg2gQDQUVNIiWk2gOiRMCKQlJ7DwcO7nYzrC7dzmdqJBYabNZOzsz9iTpTIeiKJBlKZqmQYwRdV3LWp7ntJ5J5b4sS6RpKr3WGiEEeO8PlWcTBuEPlVJoao2+7wVYU6+OkgG0VkLG+13XYRgGWGsPM8YYJM45zPOMvwYPMRgnkzAoB6tk8IQfE8kFCNS9SZ3ngNkX8iGTSdJxnM7QtQ2sGwS4bVsCMQS2xTRNolQAQ4iUHk/Xp6iyFSYL3J+doHy93IHGwDT4uDkHRkfDDqbOZK/8fsdm/QAfALsARpI7ThFXdy9Yb74QSfDjxS0+V897lVFIVVVhO44wXYuyyMWElhQrVYlCa/eAXo4M+C2ppfdhpMueaNCNcjccfFdsDh+VDVCKDTR7s3Zmyh2yKcz032AMAVwYmYGd4/7YyaVf1n7vLZV/JzbpB6sjs9uZFHuBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='구성' title='구성' src='/static/0c979072203e5bee4f2364d3a940efcf/ca1dc/img.png' srcset='/static/0c979072203e5bee4f2364d3a940efcf/e7570/img.png 170w,\n/static/0c979072203e5bee4f2364d3a940efcf/f46e7/img.png 340w,\n/static/0c979072203e5bee4f2364d3a940efcf/ca1dc/img.png 680w,\n/static/0c979072203e5bee4f2364d3a940efcf/3d463/img.png 1005w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>구성</figcaption>\n  </figure></p>\n<h3>동시성이 구현되지 않는 경우</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8068c297dc6055d88abc5d273b5b963b/3d463/img_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 44.705882352941174%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQoz31STUvDQBDtzxUK3sQ/4dGbJ2/2qBdBEPXkQRTBDxC6+WiT1ITE5jvZTXafO1tNS4sOvN2dncmb2ckbed4cjuNgOp0iikKUZQHf92FZlgFjU7PbFsNs5po8xhhc10VRFDq/NKBzVVUYLZdLCCHQti0kgF4v5BM458POe4ALiaZpTC7ddV03QEqJNE0xInZjmihz79BVtnG7vofoFXqdDCWh/Im+DPGfUZcjWsjaGrg42MfH+dj4kefCfntCmRcQRYWzk0O8Pt/oj0rM5x6CIDCdkSmlzJ7n+ZqQjD3a8F7YqprzjuDy1JxF2eD2wYMTpOBtY2Ycx/FA9GtbhHIISD0n3rTIswxSz0uZTiiudp4peIO6zHYJeS3Aro7QxPd/zog6WmPVQJGGqIpkdd4krHNgsjeGdX2MWihEYYhEPyv+AVXfJieFLBafcLSEvpLE5A2EuiaiRaZ/QquHLYymCHVdG5BcNjskmZB8Wn1PMZIRyeYbntmwzA/n638AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 1' title='img 1' src='/static/8068c297dc6055d88abc5d273b5b963b/ca1dc/img_1.png' srcset='/static/8068c297dc6055d88abc5d273b5b963b/e7570/img_1.png 170w,\n/static/8068c297dc6055d88abc5d273b5b963b/f46e7/img_1.png 340w,\n/static/8068c297dc6055d88abc5d273b5b963b/ca1dc/img_1.png 680w,\n/static/8068c297dc6055d88abc5d273b5b963b/3d463/img_1.png 1005w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<blockquote>\n<p>서버가 클라이언트의 요청이 완료되도록 요청이 완료되도록 그저 기다리기 때문에 다른 작업이 실행되지 못한다.</p>\n</blockquote>\n<ul>\n<li>서버(코어)를 늘려 처리량을 높여보자!</li>\n</ul>\n<h3>병렬성을 구현한 경우</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d41d8cd98f00b204e9800998ecf8427e/2d7cc/img_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 44.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsklEQVQoz4WSv47TQBDG/VS8Cu/AEyAqOmoKdAVCoqFAFJQg6Cg4BHdIEE5A4hA7FxzHSezg9a7X//bH7vo47kTBWp9mZmdnPPPNBIvFgtlshpOi/MVutyOKIsIwZDqdMp/PCa0/jhb+zsG9T9MUKSVCiEtUVUWglMIYw/hBPxiGYcA4mFHvraN3vt7qXWdlT2flVbi7zWZDoOsad2QWk39/Cqamb3uUbpH2ZzYfRkxpfzzkf8d1FyipvHH2asLzWzeQ6YlPEn0+Zh3PoYPpl1MeH922ASnb7dZT4oJ9ZxZNMxblfEH9p8JSM/sQ0lTS2+vXT5CLM69vMsHxZIusG/J8z3K5tHwJ7zvsV1Tl7m9CrfW1so2trrUE52WFOBwYlOvAXOD6aZqG/X7nq3V5PId1Pba8On1D8u4epqtQsiYOv5Guf1obdPqe/ONd2m5gnSTEceyDi6LwyRzyPPeTD2o1Jjx59pYXd26ii8jbyctHiPDTyO/kKw+O7lPkGWVZslqtUBdx/wzF7ZJrRylNcl7QNy2dfbxfJwjbzmA5LoUmPD+gre+SGjuMq2vj1ivLMn4DJw2qIp6I7JkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 2' title='img 2' src='/static/d41d8cd98f00b204e9800998ecf8427e/ca1dc/img_2.png' srcset='/static/d41d8cd98f00b204e9800998ecf8427e/e7570/img_2.png 170w,\n/static/d41d8cd98f00b204e9800998ecf8427e/f46e7/img_2.png 340w,\n/static/d41d8cd98f00b204e9800998ecf8427e/ca1dc/img_2.png 680w,\n/static/d41d8cd98f00b204e9800998ecf8427e/2d7cc/img_2.png 985w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<blockquote>\n<p>서버의 수가 늘어 나아졌지만.. 요청을 처리할 때까지 기다리기 때문에 다른 작업이 수행되지 못한다.</p>\n</blockquote>\n<ul>\n<li>CPU 클럭 낭비!!</li>\n</ul>\n<h3>동시성을 구현한 경우</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8c90d54b6f4b6f646acfb4caf900fada/b2a21/img_3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQoz22RyVLDMAyG+8YMw3MwA2/AoYdeOPECDAMnbnBo1tI9XcjiJE3sePmR3RZaQBONZMX6JFm96XSK0WgEz/Ow3WxQVSWOsSAI4FM8jmNEUYjxeAzf9xGGIZ0jMMZQ1zXlVN/aq+oKxhgcRZF7erZiftlTkVKSKpdj4T1LtVeVBJavfbTbF6ICJSuQZhnqkgEaaLxbGPaGjvxlssRsPkeyXjmopmQpWnAhfoAdB+4vrvA+uHSXaho9zzO0zQ6yVejf3eDp8QGyaTAJI3z4AWb0FFp0KNIFWJag69QeeBxxNUmRJfmfsTRV9iYVZusalAXTchgunIUdWWkKawjBT4Du06R7uJIdms+FOxuCuHcgX1BHdilDb+isItiuzsDyGTgX5x061sHnxRYfg2sY6kBzfgyjKxiq1Qql1SSBbjjWSYTYf6Zi8hxorfUsQFG1Ik2dr+2Yh/8w5p9Na1qIdCN/AXXlZE9Q6A+EAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 3' title='img 3' src='/static/8c90d54b6f4b6f646acfb4caf900fada/ca1dc/img_3.png' srcset='/static/8c90d54b6f4b6f646acfb4caf900fada/e7570/img_3.png 170w,\n/static/8c90d54b6f4b6f646acfb4caf900fada/f46e7/img_3.png 340w,\n/static/8c90d54b6f4b6f646acfb4caf900fada/ca1dc/img_3.png 680w,\n/static/8c90d54b6f4b6f646acfb4caf900fada/b2a21/img_3.png 987w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<blockquote>\n<p>동시성을 구현한다고 해서 클라이언트 입장에서 자신의 요청이 빨리 처리되는게 아니다.<br> <strong>어플리케이션 입장에서는 효율적으로 코어를 사용해 처리량을 높일 수 있다.</strong></p>\n</blockquote>\n<h3>동시성과 병렬성이 구현된 경우</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/be4aab628c6e0ec751877f69224071a2/08a5e/img_4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfklEQVQoz1VRa2+jMBDM//9RuY+VTqerVF1PDQFSjjygBfy2sY0zXZxepKwE3rVnHzO7qaoKdX1AUdbgjEEphebfie5qrG+73Q5lWeb40LQoij32+wIN+cZYWGvoNNBa53NjrEOcLRw/wfsAP89wooU1GkoqxBjytywJlrUIs0YICU71sGqAIIyzNmOklNj4GGEnhubnFguuVDBg//cXxDSAfQ5UgBpGj9Xqpx8wrCMU0B7e0J2I1TDBakUNPU1rsVl/q60gLwbM7DP7mnNMfQ8tRgKKO2YJAbZvkCgIPmK8XDJW07QPBVeLzmT6t+zr7e6b8n+7pgSv5UOc0oKFMFnD2XsEo8DeXxDiQjp68O4P6XITOuWElJOPv7ewoiNpgI/2FWNfgXOZNUxL/C4YPBwJe359zqQCLaYqC9LmA0PXwRlJTVwuOB0v8NQoUTxOHGyciPKZZOGEMXnrD5TnscM8XLJvaWOClqJWDY24YxINII/Vne6qn6OlKHnT8AsOJWY6Iyu7rwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 4' title='img 4' src='/static/be4aab628c6e0ec751877f69224071a2/ca1dc/img_4.png' srcset='/static/be4aab628c6e0ec751877f69224071a2/e7570/img_4.png 170w,\n/static/be4aab628c6e0ec751877f69224071a2/f46e7/img_4.png 340w,\n/static/be4aab628c6e0ec751877f69224071a2/ca1dc/img_4.png 680w,\n/static/be4aab628c6e0ec751877f69224071a2/08a5e/img_4.png 973w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<blockquote>\n<p>언어 레벨에서 하드웨어의 멀티코어를 적절하게 사용하도록 지원하기 때문에<br>\n동시성만 신경써서 개발하면 된다.</p>\n</blockquote>\n<ul>\n<li>서버(코어)를 효율적으로 사용하여 처리량을 최대화했다.</li>\n<li>클라이언트가 아닌 어플리케이션 관점에서 봐야한다.</li>\n<li>내 어플리케이션의 효율성을 높여야 한다.</li>\n<li>더불어 내 어플리케이션이 동작하는 머신의 환경이 효율적으로 돌아가도록</li>\n<li>내 어플리케이션에 메모리 누수나 자원이 낭비되지 않도록 신경쓴다.</li>\n</ul>\n<hr>\n<h2>2. 동시성 프로그래밍이 필요한 이유</h2>\n<h3>동시성 프로그래밍의 미신과 오해 (1)</h3>\n<p><strong>동시성은 항상 성능을 높여준다 (X)<br>\n동시성은 때로 성능을 높여준다 (O)</strong></p>\n<ul>\n<li>대기 시간이 아주 길어 여러 스레드가 프로세서를 공유할 수 있거나, 여러 프로세서가 동시에 처리할 독립적인 계산이 충분히 많은 경우에만 성능이 높아진다.</li>\n<li>예시: 웹 브라우저에서 여러 가지 이미지 리소스들을 불러와 다운로드할때</li>\n<li>예시 상황: ServIet</li>\n</ul>\n<h3>Java ServIet 동시성 구현</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/23098c61d4f4fbfa585868a4690032e5/ed282/img_5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQY012RSU7jUBCGfTsO0bCgzxH1JVpILFmglhjEDdigBjG0wQlKnNhx8BSPiYcoz4ZA/PWz2SBKKpVUevVPT0FWw2c1zZavVdc1wTxgrI8xDRPLsnAdB9vzcKdT5jc3+EEg38xxXZeiKFA2VcraPqbO9Q5E1G8YLxF+XCDWFaY15r5/TV9X0Ucj7h8eGKoqsSRJ1T5BFBGHIb4kybIMRURXBH8UssEvxBuEac7l9ZC7ScTq7x0z9Yqh/w8nHXF6esLe/k8Oez0WmkZSVXi2LdUbHVme5yhrCTg7Uogfe4hXiCTgbd9Bm4QsFyV2YPA8k9ayCefnZ+z+2OX3wQGOtOjJnskYngcDtKenT8DW6up2B+FddJaLVc3QWjL1S8pS8OKZ6L7GNBxhmkZ32KqZ+z6BzK8FjaTldmbLJcr3T9k2De8fWz62DZvNhjRNSZJEdtwdlDL4Vkm7T+V+IWfbSRxTCcF/JSexHvir7SMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 5' title='img 5' src='/static/23098c61d4f4fbfa585868a4690032e5/ca1dc/img_5.png' srcset='/static/23098c61d4f4fbfa585868a4690032e5/e7570/img_5.png 170w,\n/static/23098c61d4f4fbfa585868a4690032e5/f46e7/img_5.png 340w,\n/static/23098c61d4f4fbfa585868a4690032e5/ca1dc/img_5.png 680w,\n/static/23098c61d4f4fbfa585868a4690032e5/ed282/img_5.png 964w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 552px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/4dd298df7d6d118f6be22d9d8a893d87/d8a93/img_6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 51.764705882352935%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgUlEQVQoz31SPW/CQAzNv4T/gcSAxB/pUIkdBmBiYWqlLl3IAgg1IJJLmgQI+U5I8mpfSUQprSXnHN8928+2ApKqqv7U+j4MQ/i+T2eAMAhwPp8Rx3FzX59K/VPLo4CXy0WCy7KCujawE0fpDyjwLY5F4U9Zlo0+kqIoEEbf1Ty97PG6thmFUxAiy3OZsKmQDaZi2zaiKMJ0OkW/30ev18N8PpcPcwIlSYKCgLowYZgm3M0GYrFA4DjIKSGujCRlzsAgluFwiG63i06ng9lsJn11/7Isg+PY0HUdRyHwqWkITqcGKylzQHakaSodg8EA7XYbrVYLo9FI+jzPw+FwoGAOtO0WGgUyyd4aBoRlwaSK+Y4TyoDco7oPqqpiMplgPB5juVw2lFOiHJNappDBE1KxWsFzXXg0cZ5608P7Sd37OCH3MCMWq48dDMtG5jrwqFJcmf2gfLsiPGkOwFpPne0gjKT9/Cbwvvel7cfJr1VT7qv7b7FZeRNYeQf5vMWwfAEurvnThf4P9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 6' title='img 6' src='/static/4dd298df7d6d118f6be22d9d8a893d87/d8a93/img_6.png' srcset='/static/4dd298df7d6d118f6be22d9d8a893d87/e7570/img_6.png 170w,\n/static/4dd298df7d6d118f6be22d9d8a893d87/f46e7/img_6.png 340w,\n/static/4dd298df7d6d118f6be22d9d8a893d87/d8a93/img_6.png 552w' sizes='(max-width: 552px) 100vw, 552px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<ul>\n<li>요청이 들어오면 Thread Pool에 있는 Thread가 서블릿의 service() 메서드를 호출한다.</li>\n<li>service의 doGet(), doPost()에서 요청에 대한 처리를 하도록 구현한다.</li>\n</ul>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 543px; '>\n      <a class='gatsby-resp-image-link' href='/static/f22d0f903b5bd46648b445c428415f3b/10880/img_7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 82.3529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQ4y3WU22scZRiH8z95Iyoogl544ZWrqdljondeeCOCICgIelFKqYjEtAomFlsNpnhCpMVkEylWm3UDm2qS7ia7nU2ys3PYmdk5z+M7Mxtaa/zgme8wM795v/f3fjPFQy1JknzgedxpNNjd2sr4u9lke3MTXVEmD8bpZcL9NvUfMcGX8W9ewDfdHt8ph1zr3eNbpc+KzH/SDdbl/lqcUE9yVsOYVhRn70+llxOiieAdeeClcUgxhJlAkL4o/bT0r0t/xXT40rC5rFssC2+7IbOCnQpyStsTSm5EdUJFmBUK44jFSD56tIfZaWJ1WyTSb4xtZr04F4zjGFVVM4yRxWF/SP1oSNkcU1JNzrS7FPsqNcOhoDvMGzpsvMbu0rO0vngefniO+qBJTfLkxFG+ZdM00TQNezzGMW1uCSXLoyKUR25G1XIpjHwu2jZsXaD94xu0vn+LZP1N6sbeRDDOBaMoIo00FGTCdhBRdALKtkdxOKIkgrVxQMEJueS6sLOE+ftZ9D8uiPg51swDat5EMBXq9Xrs7+8zGGq02wo/HxxSlmSXBgZnOj1mlGOq2oiCOmJeU+GXV2h8/Bi/fvQ00fKTrA8aVE+2/H+mFCXJFT+hKs5WxNmazAtewqdhBMoNxjtfY++swN1l1uyjPMJkEmG/389QdZ3Ofp8b944pS1mUBjrTe508Qom4oFnM60OJ8FVaF5/g9sIzsPJUFmEteCBCV/JiWRZeIKt+SNP1KUkdVh6gJqRlc0lOELuXUTbO0V6XHG6epz7q3s9haorv+4RhKFohiefzp+NSTN2VUpmREiqJMVWZF0yXBUtc/usztJvvM7h5FhofiCmdfwsqcqy63W625W7vON9yaopq8PKBwsyhmpsytPhEGxJfr3Drw0dYPf84/tVH2RjcphqcYsrJMd8RymJCasRsaoiYMyfjaWFBSgqnB9ZdsNtZv+o5cpJiMSU5RVAWt+WgvyA5ezHNm5PmLh+na0XhHfnIu2HOe8KciM3J+igVdER9oKuYhpkZkzZLblwLYq4KXz3EFWFRjPtcWJywJFFflx9KLO/9A+uWctko0H0/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='https://www.interviewbit.com/servlet-interview-questions/' title='https://www.interviewbit.com/servlet-interview-questions/' src='/static/f22d0f903b5bd46648b445c428415f3b/10880/img_7.png' srcset='/static/f22d0f903b5bd46648b445c428415f3b/e7570/img_7.png 170w,\n/static/f22d0f903b5bd46648b445c428415f3b/f46e7/img_7.png 340w,\n/static/f22d0f903b5bd46648b445c428415f3b/10880/img_7.png 543w' sizes='(max-width: 543px) 100vw, 543px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>https://www.interviewbit.com/servlet-interview-questions/</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleHttpServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpServlet</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Not thread safe, static.</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Not thread safe</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Map</span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Thread safe to access object, not thread safe to reassign variable.</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Map</span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Thread safe to access object (immutable), not thread safe to reassign variable.</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">String</span> aString <span class=\"token operator\">=</span> <span class=\"token string\">\"a string value\"</span><span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doGet</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span>\n                          <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n\n\n        <span class=\"token comment\">// Not thread safe, unless the singleton is 100% thread safe.</span>\n        <span class=\"token class-name\">SomeClass</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSomeStaticSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        <span class=\"token comment\">// Thread safe, locally instantiated, and never escapes method.</span>\n        <span class=\"token class-name\">Set</span> set <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>해당 서블릿에 여러 쓰레드가 접근할 수 있기 때문에 멤버변수들은 Not Thread Safe 하다.</li>\n<li>doGet(), doPost()는 하나의 쓰레드 영역에서 실행되기 때문에 로컬 변수들은 Thread Safe 하다</li>\n</ol>\n<p><strong>ConcurrentHashMap→ 접근에 대해서는 Thread Safe, 하지만 값을 재 할당 하는 경우는 Thread Safe 하지 않음</strong></p>\n<h3>동시성 프로그래밍의 미신과 오해 (2)</h3>\n<p><strong>동시성을 구현해도 설계는 변하지 않는다 (X)<br/>\n동시성을 구현하면 설계를 바꿔야 한다(O)</strong></p>\n<ul>\n<li>단일 스레드 시스템과 다중 스레드 시스템은 설계가 판이 하게 다르다.</li>\n<li>'무엇'과 '언제를 분리하면 시스템의 구조가 크게 달라진다.</li>\n</ul>\n<h3>동시성 프로그래밍의 미신과 오해 (3)</h3>\n<p><strong>Web나 EJB와 같은 컨테이너를 사용한다면 동시성을 이해할 필요가 없다(X) <br/>\n컨테이너를 사용해도 동시성을 이해해야 한다(O)</strong></p>\n<ul>\n<li>어플리케이션이 컨테이너를 통해 멀티 쓰레드를 사용하는 것이기 때문에 컨테이너의 동작을 이해해야 한다.</li>\n<li>동시 수정, 데드락 같은 문제를 피할 수 있는지를 알아야 한다.</li>\n</ul>\n<hr>\n<h2>3. 안전한 동시성 프로그래밍 규칙</h2>\n<h3>단일 책임 원칙 설계(SRP)</h3>\n<h4>동시성 관련 코드는 다른 코드와 분리하라</h4>\n<ul>\n<li>동시성 코드는 독자적인 개발, 변경, 조율 주기가 있다.</li>\n<li>동시성 코드에는 독자적인 난관이 있다. 다른 코드에서 겪는 난관과 다르며 훨씬 어렵다.</li>\n<li>잘못 구현한 동시성 코드는 별의별 방식으로 실패한다.<br/>\n주변에 있는 다른 코드가 발목을 잡지 않더라도 동시성 하나만으로도 충분히 어렵다</li>\n</ul>\n<h3>자료 범위를 제한하라</h3>\n<h4>공유 자료를 최대한 줄여라</h4>\n<ul>\n<li>동시 수정 문제를 피하기 위해 객체를 사용하는 코드 내 임계영역을 synchronized 키워드로 보호하라</li>\n<li>보호할 임계영역을 빼먹거나, 모든 임계영역을 보호했는지 확인하느라 수고가 드므로 임계 영역의 수를 최소화 해야 한다. (임계영역 작게 만들고, 적게 만들어야 한다.)</li>\n</ul>\n<h3>자료 사본을 사용하라</h3>\n<h4>공유 자료를 줄이려면, 최대한 공유하지 않는 방법이 제일 좋다. (각각 로컬변수로 활용)</h4>\n<ul>\n<li>객체를 복사해 읽기 전용으로 사용한다.</li>\n<li>각 스레드가 객체를 복사해 사용한 후 한 스레드가 해당 사본에서 결과를 가져온다.</li>\n<li>사본을 사용하는 방식으로 내부 잠금을 없애 수행 시간을 절약하는 것이<br/>\n사본 생성과 가비지 컬렉션(GC)에 드는 부하를 상쇄할 가능성이 크다.</li>\n</ul>\n<h3>Thread는 가능한 독립적으로 구현하라</h3>\n<h4>다른 스레드와 자료를 공유하지 않는다.</h4>\n<ul>\n<li>서블릿처럼 각 Thread는 클라이언트 요청 하나를 처리한다.</li>\n<li>모든 정보는 비공유 출처(client의 request)에서 가져오며 로컬 변수에 저장한다.</li>\n<li>각 서블릿은 마치 자신이 독자적인 시스템에서 동작하는 양 요청을 처리한다.</li>\n</ul>\n<h3>라이브러리를 이해하라</h3>\n<h4>Java.util.concurrent 패키지를 익혀라</h4>\n<ul>\n<li>Thread Safe한 컬렉션을 사용한다.<br/>\nConcurrentHashMap, AtomicLong</li>\n<li>서로 무관한 작업을 수행할 때는 executor 프레임워크를 사용한다.</li>\n<li>가능하다면 Thread가 Blocking되지 않는 방법을 사용한다</li>\n</ul>\n<h3>동기화하는 메서드 사이에 존재하는 의존성을 이해하라</h3>\n<h4>공유 객체 하나에는 메서드 하나만 사용하라</h4>\n<ul>\n<li>클라이언트에서 잠금 - 클라이언트 첫 번째 메서드를 호출하기 전에 서버를 잠근다. 마지막 메서드를 호출할 때까지 잠금을 유지한다.</li>\n<li>서버에서 잠금 - 서버에다 \"서버를 잠그고 모든 메서드를 호출한 후 잠금을 해체하는\" 메서드를 구현한다. 클라이언트는 이 메서드를 호출하기만 하면 된다.</li>\n<li>연결(Adapter) 서버 - 잠금을 수행하는 중간 단계를 생성한다. '서버에서 잠금' 방식과 유사하지만 원래 서버는 변경하지 않는다.</li>\n</ul>\n<h3>문제상황 : 공유 자원 접근</h3>\n<h4>서버</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegerIterator</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> nextValue <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">return</span> nextValue <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextValue <span class=\"token operator\">==</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span> \n        \t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InteratorPastEndException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> nextValue<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> syncronized <span class=\"token class-name\">Integer</span> <span class=\"token function\">getNextValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">return</span> nextValue<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>클라이언트</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 공유 자료</span>\n<span class=\"token class-name\">IntegerInterator</span> iterator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Thread에서 호출되는 코드</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> nextValue <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Thread1이 hasNext()  true를 받았으나 잠시 다른 일에 선점당한다.</li>\n<li>Thread2가 hasNext()  true를 받고 next()를 호출한다.</li>\n<li>Thread1이 실행을 재개하여 next()를 또 호출한다.</li>\n</ul>\n<h3>Client Based Lock</h3>\n<h4>서버</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 공유 자료</span>\n<span class=\"token class-name\">IntegerInterator</span> iterator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Thread에서 호출되는 코드</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> nextValue<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        \t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        nextValue <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">doSomethingWith</span><span class=\"token punctuation\">(</span>nextValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>클라이언트</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 공유 자료</span>\n<span class=\"token class-name\">IntegerInterator</span> iterator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Thread에서 호출되는 코드</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> nextValue<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        nextValue <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">doSometingWith</span><span class=\"token punctuation\">(</span>nextValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>클라이언트에서 락을 걸어 Thread Safe 하게 블록을 보호한다</li>\n<li>자원을 사용하는 클라이언트마다 위의 처리를 해줘야 한다. 비효율적!</li>\n</ul>\n<h3>Server Based Lock</h3>\n<h4>서버</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegerIteratorServerLocked</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> nextValue <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> syncronized <span class=\"token class-name\">Integer</span> <span class=\"token function\">getNextOrNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextValue <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span> \n            <span class=\"token keyword\">return</span> nextValue<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">else</span> \n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>클라이언트</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 공유 자료</span>\n<span class=\"token class-name\">IntegerInterator</span> iterator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Thread에서 호출되는 코드</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Integer</span> nextValue <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">getNextOrNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>next <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> \n    \t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>서버에서 두 개로 나눠졌던 동작을 하나로 합쳐 락을 건다.</li>\n<li>클라이언트에서는 보호된 메서드를 호출하기만 하면 된다.</li>\n</ul>\n<h3>Adapter Based Lock</h3>\n<h4>서버</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegerIterator</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Integer</span> nextValue <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">return</span> nextValue <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextValue <span class=\"token operator\">==</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">)</span> \n        \t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InteratorPastEndException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> nextValue<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> syncronized <span class=\"token class-name\">Integer</span> <span class=\"token function\">getNextValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">return</span> nextValue<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>어뎁터</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadSafeIntegerIterator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">IntegerIterator</span> iterator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token class-name\">Integer</span> <span class=\"token function\">getNextOrNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n            <span class=\"token keyword\">return</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>클라이언트</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 공유 자료</span>\n<span class=\"token class-name\">ThreadSafeIntegerIterator</span> iterator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadSafeIntegerIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Thread에서 호출되는 코드</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Integer</span> nextValue <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">getNextOrNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>next <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>어댑터에서 서버에서 두 개로 나눠졌던 동작을 하나로 합쳐 락을 건다.</li>\n<li>클라이언트에서는 보호된 메서드를 호출하기만 하면 된다.</li>\n<li>\n<h2>서버의 코드가 외부 코드라서 수정할 수 없을 때 우리 코드에서 Adapter를 만들어 사용한다.</h2>\n<h2>3. 동시성 테스트 방법</h2>\n</li>\n</ul>\n<blockquote>\n<p><strong>테스트를 했다고 동시성 코드가 100% 올바르다고 증명하기는 불가능하다. 하지만 충분한 테스트는 위험을 낮춘다.</strong></p>\n</blockquote>\n<ul>\n<li>문제를 노출하는 테스트 케이스를 작성하라</li>\n<li>프로그램의 설정과 시스템 설정과 부하를 바꿔가며 자주 들려라</li>\n<li>테스트가 실패하면 원인을 추적하라</li>\n<li>다시 돌렸더니 통과한다는 이유로 그냥 넘어가면 절대로 안된다</li>\n</ul>\n<h3>코드에 보조 코드를 넣어 돌려라</h3>\n<blockquote>\n<p><strong>드물게 발생하는 오류를 자주 발생시키도록 보조 코드를 추가한다</strong></p>\n</blockquote>\n<ul>\n<li>코드에 wait(), sleep(), yield(), priority() 함수를 추가해 직접 구현한다.</li>\n<li>\n<p>보조코드를 넣어주는 도구를 사용해 테스트한다.</p>\n<ul>\n<li>다양한 위치에 ThreadJigglePoint.jiggle() 추가해 무작위로 sleep, yield()가 호출되도록 한다.</li>\n</ul>\n</li>\n<li>테스트 환경에서 보조 코드를 돌려본다.</li>\n</ul>\n<h3>동시성 코드를 실제 환경이나 테스트 환경에서 돌려본다</h3>\n<blockquote>\n<p>다양한 요청과 상황에 동시성 코드가 정상적으로 동작하는지 확인한다</p>\n</blockquote>\n<ul>\n<li>배포하기 전에 테스트 환경에서 충분히 오랜시간 검증한다.</li>\n<li>동시성 코드를 배포한 후에 모니터링을 통해 문제가 발생하는지 지켜본다.</li>\n</ul>","frontmatter":{"title":"[클린코드-12] 동시성을 구현할 때 명심할 것들","date":"July 09, 2024","update":"July 09, 2024","tags":["독서","Clean Code"],"series":"Clean Code"},"fields":{"slug":"/CleanCode-12/","readingTime":{"minutes":14.835}}},"seriesList":{"edges":[{"node":{"id":"b406bb1d-20e8-56cf-aeb9-372b40275c78","fields":{"slug":"/CleanCode-1/"},"frontmatter":{"title":"[클린코드-1] 클린 코드와 그 첫걸음"}}},{"node":{"id":"d34f1573-694e-5d31-9fc0-6abc568f788b","fields":{"slug":"/CleanCode-2/"},"frontmatter":{"title":"[클린코드-2] 함수를 안전하고 간결하게 작성하기"}}},{"node":{"id":"2561081f-3b40-5810-aed4-4688770e362d","fields":{"slug":"/CleanCode-3/"},"frontmatter":{"title":"[클린코드-3] 코드를 보조하는 주석"}}},{"node":{"id":"8bfe4c44-e879-5335-b3be-9acce01ed2f5","fields":{"slug":"/CleanCode-4/"},"frontmatter":{"title":"[클린코드-4] 코드의 가독성에 필수적인 포맷팅"}}},{"node":{"id":"cdf67bfa-eb4b-5d41-98f4-02a410c11737","fields":{"slug":"/CleanCode-5/"},"frontmatter":{"title":"[클린코드-5] 객체와 자료구조로 데이터 표현하기"}}},{"node":{"id":"7725a8eb-56b3-5e37-b8c3-fbb65def1d62","fields":{"slug":"/CleanCode-6/"},"frontmatter":{"title":"[클린코드-6] 우아하게 예외 처리하기"}}},{"node":{"id":"4e262a40-e19d-5830-a48c-e46c38f62ce8","fields":{"slug":"/CleanCode-7/"},"frontmatter":{"title":"[클린코드-7] 모호한 경계를 적당히 구분짓기"}}},{"node":{"id":"be7a0d17-10d6-5dda-b0ad-86b9b87794df","fields":{"slug":"/CleanCode-8/"},"frontmatter":{"title":"[클린코드-8] 깨끗한 테스트 코드"}}},{"node":{"id":"7cffdb26-f508-50f1-ac60-9d891e5a4456","fields":{"slug":"/CleanCode-9/"},"frontmatter":{"title":"[클린코드-9] 클래스 잘 설계하기"}}},{"node":{"id":"6b99e341-03c1-5ef1-b715-2f9e60cb34c9","fields":{"slug":"/CleanCode-10/"},"frontmatter":{"title":"[클린코드-10] 클래스 잘 설계하기"}}},{"node":{"id":"de25428c-8bc8-5e86-8726-6dbcb1b4bf08","fields":{"slug":"/CleanCode-11/"},"frontmatter":{"title":"[클린코드-11] 창발적 설계로 깔끔한 코드 구현하기"}}},{"node":{"id":"f0d45dae-fb83-52a6-9bc5-1beb3151e378","fields":{"slug":"/CleanCode-12/"},"frontmatter":{"title":"[클린코드-12] 동시성을 구현할 때 명심할 것들"}}},{"node":{"id":"edf24aed-a5f5-5f44-90c0-fc225ea827bc","fields":{"slug":"/CleanCode-13/"},"frontmatter":{"title":"[클린코드-13] 코드를 점진적으로 개선하기"}}},{"node":{"id":"b102e556-5534-546b-92e0-60de71dee846","fields":{"slug":"/CleanCode-14/"},"frontmatter":{"title":"[클린코드-14] 라이브러리 분석을 통해 코드를 바라보는 시각 기리기"}}}]},"previous":{"fields":{"slug":"/CleanCode-11/"},"frontmatter":{"title":"[클린코드-11] 창발적 설계로 깔끔한 코드 구현하기"}},"next":{"fields":{"slug":"/CleanCode-13/"},"frontmatter":{"title":"[클린코드-13] 코드를 점진적으로 개선하기"}}},"pageContext":{"id":"f0d45dae-fb83-52a6-9bc5-1beb3151e378","series":"Clean Code","previousPostId":"de25428c-8bc8-5e86-8726-6dbcb1b4bf08","nextPostId":"edf24aed-a5f5-5f44-90c0-fc225ea827bc"}},"staticQueryHashes":[]}